{% load helpertags %}

<nav>
    <div id="filter-help" class="code hidden">
        Start typing to filter&hellip;
    </div>

    <div id="filter-display" class="code hidden">
    
    </div>
</nav>

<div id="search"></div>

<dl id="help" class="hidden">
    <!-- <dt>What is this?</dt>
    <dd>
    </dd> -->
    <dt>Census tracts</dt>
    <dd>
        {% help_text "TRACTS" %}
    <dd>
    <dt>Places</dt>
    <dd>
        {% help_text "PLACES" %}
    <dd>
    <dt>Counties (parishes in LA)</dt>
    <dd>
        {% help_text "COUNTIES" %}
    <dd>
</dl>

<script src="{% build_media_url '/js/query.js' %}"></script>

<script id="query-template" type="x-js-template">

    <% if (query.get('summarylevel')) { %>
        <span id="summarylevel-select">
            <span class="link">Find data</span> for
            <% if (_.values(query.attributes).length > 2) { %>
                <span class="link" data-val="<%= query.get('summarylevel') %>"><%= query.get('summarylevelDisplay') %></span>
            <% } else { %>
                <b><%= query.get('summarylevelDisplay') %></b>
            <% } %>
        </span>
    <% } else { %>
        Find data for
        <span id="summarylevel-select">
            <span class="link" data-val="<%= SUMLEV_TRACT %>"><%= query.mappings.summarylevelDisplays[SUMLEV_TRACT] %></span>,
            <span class="link" data-val="<%= SUMLEV_PLACE %>"><%= query.mappings.summarylevelDisplays[SUMLEV_PLACE] %></span>,
            <span class="link" data-val="<%= SUMLEV_COUNTY %>"><%= query.mappings.summarylevelDisplays[SUMLEV_COUNTY] %></span>,
            <span class="link" data-val="<%= SUMLEV_STATE %>"><%= query.mappings.summarylevelDisplays[SUMLEV_STATE] %></span>, or
            <span class="link" data-val="<%= SUMLEV_NATION %>"><%= query.mappings.summarylevelDisplays[SUMLEV_NATION] %></span>.
        </span>
    <% } %>

    <% if (query.get('summarylevel') && (query.get('summarylevel') != SUMLEV_NATION) && !query.get(SUMLEV_STATE)) { %>
        in
        <span id="state-select">
            <% var states = query.filtered(query.mappings.states); %>
            <% _.each(states, function(pair, i) { %>
                <span class="link" data-val="<%= pair[1] %>"><%= pair[0] %></span><%= i == states.length - 1 ? '' : ', ' %>
            <% }); %>
        </span>
    <% } else if (query.get(SUMLEV_STATE)) { %>
        in
        <% if (_.values(query.attributes).length > 5) { %>
            <span id="state-select"><span class="link" data-val="<%= query.get(SUMLEV_STATE) %>"><%= query.get(SUMLEV_STATE + 'Display') %></span></span>
        <% } else { %>
            <b><%= query.get(SUMLEV_STATE +'Display') %></b>
        <% } %>
    <% } %>

    <% if (query.mappings.counties && !query.get(SUMLEV_COUNTY)) { %>
        for
        <span id="county-select">
            <% var counties = query.filtered(query.mappings.counties); %>
            <% _.each(counties, function(pair, i) { %>
                <span class="link" data-val="<%= pair[1] %>"><%= pair[0] %></span><%= i == counties.length - 1 ? '' : ', ' %>
            <% }); %>
        </span>
    <% } else if (query.get(SUMLEV_COUNTY)) { %>
        - <b><%= query.get(SUMLEV_COUNTY + 'Display') %></b>.
    <% } %>

    <% if (query.mappings.places && !query.get(SUMLEV_PLACE)) { %>
        for
        <span id="place-select">
            <% var places = query.filtered(query.mappings.places); %>
            <% _.each(places, function(pair, i) { %>
                <span class="link" data-val="<%= pair[1] %>"><%= pair[0] %></span><%= i == places.length - 1 ? '' : ', ' %>
            <% }); %>
        </span>
    <% } else if (query.get(SUMLEV_PLACE)) { %>
        - <b><%= query.get(SUMLEV_PLACE + 'Display') %></b>.
    <% } %>

    <% if (query.mappings.tracts && !query.get(SUMLEV_TRACT)) { %>
        for
        <span id="tract-select">
            <% var tracts = query.filtered(query.mappings.tracts); %>
            <% _.each(tracts, function(pair, i) { %>
                <span class="link" data-val="<%= pair[1] %>"><%= pair[0] %></span><%= i == tracts.length - 1 ? '' : ', ' %>
            <% }); %>
        </span>
    <% } else if (query.get(SUMLEV_TRACT)) { %>
        - <b><%= query.get(SUMLEV_TRACT + 'Display') %></b>.
    <% } %>

    <% if (query.isCompletable()) { %>
        <div>
            Download data for listed geographies as <span class="button csv-json">CSV</span> <span class="button csv-json">JSON</span>
        </div>
    <% } %>

    <div id="help-link">Huh?</div>

</script>
