{% extends 'base.html' %}
{% load helpertags %}

{% block content %}

<nav>
    <span class="button more-data">Add another geography to compare</span>
    &nbsp;or download as
    <a class="button" href="{{ csv_url }}">CSV (TKTK)</a>
    <a class="button" href="{{ json_url }}">JSON (TKTK)</a>
</nav>
<div class="query-builder-popup hidden">
    {% include "_query_builder.html" %}
</div>

<script type="text/javascript">
    $(function(){
        $('.button.more-data').click(function(){
            $('.query-builder-popup').dialog({minHeight:400, minWidth:800});
        });
        $('.button.remove-report').click(function(){
            slug = $(this).attr('data-val');
            newLocation = window.location.pathname.replace('/' + slug,'');
            if (newLocation == '/data.html') {
                //you've closed the last report, time to go home
                window.location = '/';                
            } else {
                window.location = newLocation;
            }

        });
    });
</script>

{% for r in reports %}
{{ r.year }} - {{ r.table }}
<table class="reports">
    <tr>
        <td>
            <table class="report">
                <tr class="title">
                    <th>
                        Field
                    </th>
                    {% for c in r.columns %}
                    <th>
                        Tract #{{ c.tract }} - {{ c.county }}, {{ c.state }}
                        {#<span class="button remove-report" data-val="{{ g.geoid }}">X</span>#}
                    </th>
                    {% endfor %}
                </tr>
            {% for label, data in r.rows %}
            <tr class="{% cycle odd,even %} indent-{{ row.indent }}">
                <td class="first">{{ label.text }}</td>
                {% for d in data %}
                <td class="code">{{ d|default_if_none:"" }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
            </table>
        </td>
    </tr>
</table>
{% endfor %}

{% endblock %}
