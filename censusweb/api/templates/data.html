{% extends 'base.html' %}
{% load helpertags %}
{% load humanize %}

{% block content %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/report.js"></script>
<script id="browser-template" type="x-js-template">
<h1>Hello!</h1>
<ul id="table-list" class="cookie1">
<% _.each(model.attributes, function(label) { %>
    <li id="<%= label.key %>">
        <input type="checkbox" id="show-<%= label.key %>" name="show-<%= label.key %>">
        <label for="show-<%= label.key %>">
            <a href="#table-<%= label.key %>" class="link"><%= label.name %></a></label>
    </li>
<% }); %>
</ul>
</script>

<nav>
    <span class="button more-data">Add another geography to compare</span>
    &nbsp;or download as
    <a class="button" href="{{ csv_url }}">CSV</a>
    <a class="button" href="{{ json_url }}">JSON</a>
</nav>
<div class="query-builder-popup hidden">
    {% include "_query_builder.html" %}
</div>

<script type="text/javascript">
    $(function(){
        $('.button.more-data').click(function(){
            $('.query-builder-popup').dialog({minHeight:400, minWidth:800});
            query.initializeWithGeography({{ last_geoid }});
        });
    });
</script>

{% for r in reports %}
<a name="table-{{r.key}}"></a>
<table class="report">
    <colgroup></colgroup><colgroup></colgroup>
    {% for c in r.columns %}
    <colgroup></colgroup><colgroup></colgroup><colgroup></colgroup><colgroup></colgroup>
    {% endfor %}
    <tr>
        <th rowspan="2" class="labeldef">{{ r.table }}<br /><span class="universe">Universe: {{ r.universe }}</span></th>
        {% for c in r.columns %}
        <th colspan="4" class="locationdef">
            {{ c.name }}
            <div class="button-set">
            {% if c.sumlev == "050" or c.sumlev == "160" %}
                <span class="button show-family" title="Show items that contain this" data-val="{{ c.geoid }}">Compare to state</span>
            {% else %}{% if c.sumlev == "140" or c.sumlev == "101" %}
                <span class="button show-family" title="Show items that contain this" data-val="{{ c.geoid }}">Compare to state and county</span>
            {% endif %}{% endif %}
            {% if show_remove_button %}
                <span class="button remove-column" data-val="{{ c.geoid }}">Remove</span>
            {% endif %}
            </div>
        </th>
        {% endfor %}
    <tr>
        {% for c in r.columns %}
        <th class="subhead">2000</th>
        <th class="subhead">2010</th>
        <th class="subhead">Delta</th>
        <th class="subhead">% change</th>
        {% endfor %}
    </tr>
    </tr>
    {% for label, data, key in r.rows %}
    <tr
        class="{% cycle odd,even %} indent-{{ label.indent }} row {% if label.has_children %} has-children {% if label.indent > 1 %}closed{% else %}open{% endif %}{% endif %}"
        id="{{ key }}" parent="{{ label.parent }}"
        style="{% if label.indent > 2 %}display:none;{% endif %}"
    >
        <td class="label">{{ label.text }} <span class="key">{{ key }}</span></td>
        {% for d in data %}
            <td class="code data-cell">{{ d.2000|intcomma }}</td>
            <td class="code data-cell">{{ d.2010|intcomma }}</td>
            <td class="code data-cell">{{ d.delta|intcomma }}</td>
            <td class="code data-cell {% if forloop.last %}last{% endif %}">{{ d.pct_change|percent|floatformat:-1 }}</td>
        {% endfor %}
    </tr>
    {% endfor %}
</table>
{% endfor %}

{% endblock %}
