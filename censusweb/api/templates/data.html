{% extends 'base.html' %}

{% block content %}

<nav>
    <span class="button more-data">Add another geography to compare</span>
    &nbsp;or download as
    <a class="button" href="{{ csv_url }}">CSV</a>
    <a class="button" href="{{ json_url }}">JSON</a>
</nav>
<div class="query-builder-popup hidden">
    {% include "_query_builder.html" %}
</div>

<script type="text/javascript">
    SUMLEV_NATION = '010'
    SUMLEV_STATE = '040'
    SUMLEV_COUNTY = '050'
    SUMLEV_TRACT = '140'
    SUMLEV_PLACE = '160'
    SUMLEV_BLOCK = '101'
    
    last_sumlev = '{{ last_sumlev }}';
    last_geoid = '{{ last_geoid }}';

    $(function(){
        $('.button.more-data').click(function(){
            $('.query-builder-popup').dialog({minHeight:400, minWidth:800});
            
            ///NONONO, forget this. make it do a callback for the info. create a method called 'setup picker' or something, it does JSON
        
            // switch(last_sumlev)
            // {
            //     case SUMLEV_TRACT:
            //         var state = last_geoid.substr(0,2);
            //         var county = last_geoid.substr(0,5);
            //         query.set({'state': state, 'county': county, 'summarylevel':'tract'});
            //         query.loadTracts();
            // }
            
            // query.set({'state':'10'});
            // query.set({'county':'10001'});
            // query.loadTracts();
            
            query.initializeWithGeography(last_geoid);
        });
    });
</script>

{% for r in reports %}
<table class="report">
    <tr>
        <th rowspan="2" class="labeldef">{{ r.table }}<br /><span class="universe">Universe: {{ r.universe }}</span></th>
        {% for c in r.columns %}
        <th colspan="4" class="locationdef">
            {{ c.name }}
            {% if c.sumlev != "040" %}
                <span class="button show-family" title="Show items that contain this" data-val="{{ c.geoid }}">F</span>
            {% endif %}
            {% if show_remove_button %}
                <span class="button remove-column" data-val="{{ c.geoid }}">X</span>
            {% endif %}
        </th>
        {% endfor %}
    <tr>
        {% for c in r.columns %}
        <th class="subhead">2000</th>
        <th class="subhead">2010</th>
        <th class="subhead">Delta</th>
        <th class="subhead">% change</th>
        {% endfor %}
    </tr>
    </tr>
    {% for label, data, key in r.rows %}
    <tr
        class="{% cycle odd,even %} indent-{{ label.indent }} row {% if label.has_children %} has-children {% if label.indent > 1 %}closed{% else %}open{% endif %}{% endif %}"
        id="{{ key }}" parent="{{ label.parent }}"
        style="{% if label.indent > 2 %}display:none;{% endif %}"
    >
        <td class="label">{{ label.text }} <span class="key">{{ key }}</span></td>
        {% for d in data %}
            <td class="code data-cell">{{ d.2000 }}</td>
            <td class="code data-cell">{{ d.2010 }}</td>
            <td class="code data-cell">{{ d.delta }}</td>
            <td class="code data-cell {% if forloop.last %}last{% endif %}">{{ d.pct_change|floatformat:-3 }}</td>
        {% endfor %}
    </tr>
    {% endfor %}
</table>
{% endfor %}

{% endblock %}
